<base:UserControlBase
    x:Class="HotPotPlayer.Video.VideoControl"
    xmlns:base="using:HotPotPlayer"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:HotPotPlayer.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:canvas="using:Microsoft.Graphics.Canvas.UI.Xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:convs="using:HotPotPlayer.Converters"
    xmlns:animations="using:CommunityToolkit.WinUI.UI.Animations"
    mc:Ignorable="d">

    <base:UserControlBase.Resources>
        <convs:SliderThumbConverter x:Key="SliderThumbConverter" TotalTime="{x:Bind CurrentPlayingDuration, Mode=OneWay}"/>
        <convs:SliderVolumeIntConverter x:Key="SliderVolumeConverter" />
        <convs:ColorConverter x:Key="ColorConverter" />
        <AcrylicBrush x:Key="PlayBarBackground" TintOpacity="0.8" TintLuminosityOpacity="0.3" TintColor="Transparent" FallbackColor="Transparent" />

        <Style x:Key="VolumePopupStyle" TargetType="FlyoutPresenter">
            <Setter Property="MinWidth" Value="160" />
            <Setter Property="MaxWidth" Value="160" />
            <Setter Property="MinHeight" Value="40" />
            <Setter Property="MaxHeight" Value="40" />
            <Setter Property="Padding" Value="12,0" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="ScrollViewer.HorizontalScrollMode" Value="Disabled"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollMode" Value="Disabled"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Disabled"/>
        </Style>

    </base:UserControlBase.Resources>

    <Grid PointerEntered="Grid_PointerEntered" PointerMoved="Grid_PointerMoved">
        <SwapChainPanel x:Name="Host" Loaded="Host_Loaded" CompositionScaleChanged="Host_CompositionScaleChanged" SizeChanged="Host_SizeChanged" Unloaded="Host_Unloaded"/>

        <Grid Background="#e0ffffff" CornerRadius="8" VerticalAlignment="Bottom" Margin="16,0,16,16" Visibility="{x:Bind PlayBarVisible, Mode=OneWay}" PointerEntered="PlayBar_PointerEntered" PointerExited="PlayBar_PointerExited">

            <animations:Implicit.ShowAnimations>
                <animations:TranslationAnimation Duration="0:0:1" From="0,80,0" To="0,0,0" EasingMode="EaseOut"/>
            </animations:Implicit.ShowAnimations>
            <animations:Implicit.HideAnimations>
                <animations:TranslationAnimation Duration="0:0:0.8" From="0,0,0" To="0,80,0" />
            </animations:Implicit.HideAnimations>
            
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="1*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Grid Grid.ColumnSpan="3" Margin="12,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Margin="0,0,8,-3" Width="34" VerticalAlignment="Center" Text="{x:Bind CurrentTime.ToString('mm\\\\:ss'), Mode=OneWay}" FontFamily="{ThemeResource MiSansRegular}" FontSize="12"/>
                <Slider x:Name="PlaySlider" Grid.Column="1" Translation="0,2,0" Style="{StaticResource PlaySliderStyle}" Value="{x:Bind GetSliderValue(CurrentTime, CurrentPlayingDuration), Mode=OneWay}" ThumbToolTipValueConverter="{StaticResource SliderThumbConverter}" >
                </Slider>
                <TextBlock Grid.Column="2" Margin="8,0,0,-3" Width="34" VerticalAlignment="Center" Text="{x:Bind GetDuration(CurrentPlayingDuration), Mode=OneWay}" FontFamily="{ThemeResource MiSansRegular}" FontSize="12"/>
            </Grid>

            <!--Left-->
            <Grid Grid.Row="1">

            </Grid>

            <!--Center-->
            <Grid Grid.Column="1" Grid.Row="1" Margin="0,0,0,16">
                <StackPanel Margin="0,0,0,-8" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="4">
                    <Button Style="{StaticResource PlayOtherButton}" Click="PlayModeButtonClick">
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="{x:Bind GetPlayModeIcon(PlayMode), Mode=OneWay}" />
                    </Button>
                    <Button Click="PlayButtonClick" Style="{StaticResource PlayButton}">
                        <SymbolIcon Symbol="{x:Bind GetPlayButtonSymbol(IsPlaying, x:False), Mode=OneWay}" />
                    </Button>
                    <Button Style="{StaticResource PlayOtherButton}">
                        <SymbolIcon Symbol="Refresh" />
                    </Button>
                </StackPanel>
            </Grid>

            <!--Right-->
            <StackPanel Grid.Column="2" Grid.Row="1" Margin="8,0,16,0" Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button Style="{StaticResource VolumeButton}">
                    <local:VolumeIntPresenter Volume="{x:Bind Volume, Mode=OneWay}"/>
                    <Button.Flyout>
                        <Flyout FlyoutPresenterStyle="{StaticResource VolumePopupStyle}">
                            <Slider Margin="0,2,0,0" Value="{x:Bind Volume, Mode=TwoWay, Converter={StaticResource SliderVolumeConverter}}" IsThumbToolTipEnabled="False"/>
                        </Flyout>
                    </Button.Flyout>
                </Button>
                <Button Style="{StaticResource PlayOtherButton}" Click="ToggleStatusClick">
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE946;" />
                </Button>
                <Button Style="{StaticResource PlayOtherButton}" >
                    <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE762;" />
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
    
    
</base:UserControlBase>
